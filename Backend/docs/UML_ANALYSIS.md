# ğŸ“Š AnÃ¡lisis UML - Stockly Backend v1.3.0

**Ãšltima ActualizaciÃ³n:** 22 de Octubre, 2025  
**PropÃ³sito:** Referencia completa para arquitectura, modelos de datos, flujos y diagramas

---

## ğŸ“‘ Tabla de Contenidos

1. [Diagrama ER - Modelo de Datos](#diagrama-er---modelo-de-datos)
2. [Diagrama de Clases](#diagrama-de-clases)
3. [Diagrama de Secuencia - Flujos Principales](#diagrama-de-secuencia---flujos-principales)
4. [Diagrama de Casos de Uso](#diagrama-de-casos-de-uso)
5. [Diagrama de Componentes](#diagrama-de-componentes)
6. [Relaciones entre Entidades](#relaciones-entre-entidades)
7. [Flujos de AutenticaciÃ³n](#flujos-de-autenticaciÃ³n)
8. [Estado de Transacciones](#estado-de-transacciones)

---

## ğŸ—‚ï¸ Diagrama ER - Modelo de Datos

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    STOCKLY DATABASE v1.3.0                       â”‚
â”‚                   Multi-Tenant Architecture                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚    USERS     â”‚
                          â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
                          â”‚ id (PK)      â”‚
                          â”‚ email        â”‚
                          â”‚ password     â”‚
                          â”‚ name         â”‚
                          â”‚ phone        â”‚
                          â”‚ created_at   â”‚
                          â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                          N:M Relationship
                                 â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                         â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚ USER_COMPANY     â”‚      â”‚   COMPANIES      â”‚
          â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚      â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
          â”‚ id (PK)          â”‚      â”‚ id (PK)          â”‚
          â”‚ user_id (FK)     â”‚      â”‚ name             â”‚
          â”‚ company_id (FK)  â”‚      â”‚ ruc              â”‚
          â”‚ role             â”‚      â”‚ address          â”‚
          â”‚ created_at       â”‚      â”‚ email            â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚ phone            â”‚
                                    â”‚ created_at       â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                             â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                        â”‚                        â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   CATEGORIES         â”‚  â”‚    PRODUCTS      â”‚  â”‚   INVITATIONS        â”‚
        â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
        â”‚ id (PK)              â”‚  â”‚ id (PK)          â”‚  â”‚ id (PK)               â”‚
        â”‚ company_id (FK)      â”‚  â”‚ company_id (FK)  â”‚  â”‚ company_id (FK)       â”‚
        â”‚ name                 â”‚  â”‚ category_id (FK) â”‚  â”‚ code (UNIQUE)         â”‚
        â”‚ parent_id (FK)       â”‚  â”‚ sku              â”‚  â”‚ role                  â”‚
        â”‚ description          â”‚  â”‚ name             â”‚  â”‚ created_by (FK)       â”‚
        â”‚ is_active            â”‚  â”‚ description      â”‚  â”‚ expires_at            â”‚
        â”‚ created_at           â”‚  â”‚ price            â”‚  â”‚ used                  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ stock            â”‚  â”‚ created_at            â”‚
                                   â”‚ condition        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚ created_at       â”‚
                                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                            â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                       â”‚                       â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  PRODUCT_ATTRIBUTES â”‚  â”‚      SALES         â”‚ â”‚  INVOICES          â”‚
        â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
        â”‚ id (PK)              â”‚  â”‚ id (PK)            â”‚ â”‚ id (PK)            â”‚
        â”‚ product_id (FK)      â”‚  â”‚ company_id (FK)    â”‚ â”‚ company_id (FK)    â”‚
        â”‚ attribute_name       â”‚  â”‚ user_id (FK)       â”‚ â”‚ sale_id (FK)       â”‚
        â”‚ attribute_value      â”‚  â”‚ customer_name      â”‚ â”‚ invoice_number     â”‚
        â”‚ created_at           â”‚  â”‚ customer_email     â”‚ â”‚ invoice_date       â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ serial_number      â”‚ â”‚ customer_name      â”‚
                                   â”‚ serial_image_url   â”‚ â”‚ subtotal           â”‚
                                   â”‚ total              â”‚ â”‚ tax_amount         â”‚
                                   â”‚ warranty_months    â”‚ â”‚ total_amount       â”‚
                                   â”‚ payment_method     â”‚ â”‚ payment_status     â”‚
                                   â”‚ is_paid            â”‚ â”‚ is_draft           â”‚
                                   â”‚ created_at         â”‚ â”‚ created_at         â”‚
                                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                            â”‚                      â”‚
                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
                            â”‚                              â”‚        â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚    WARRANTIES        â”‚    â”‚ INVOICE_LINE_ITEMS       â”‚
                â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
                â”‚ id (PK)              â”‚    â”‚ id (PK)                  â”‚
                â”‚ sale_id (FK)         â”‚    â”‚ invoice_id (FK)          â”‚
                â”‚ serial_number        â”‚    â”‚ company_id (FK)          â”‚
                â”‚ expires_at           â”‚    â”‚ product_id (FK) NULLABLE â”‚
                â”‚ is_active            â”‚    â”‚ item_type                â”‚
                â”‚ created_at           â”‚    â”‚ item_name                â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ quantity                 â”‚
                            â”‚                â”‚ unit_price               â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚ line_total               â”‚
                â”‚ SERVICE_HISTORIES    â”‚    â”‚ is_taxable               â”‚
                â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚    â”‚ line_order               â”‚
                â”‚ id (PK)              â”‚    â”‚ created_at               â”‚
                â”‚ warranty_id (FK)     â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚ serial_number        â”‚
                â”‚ status               â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚ reason               â”‚ â”‚      PURCHASES        â”‚
                â”‚ photos_url           â”‚ â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
                â”‚ entry_date           â”‚ â”‚ id (PK)               â”‚
                â”‚ entry_time           â”‚ â”‚ company_id (FK)       â”‚
                â”‚ created_at           â”‚ â”‚ supplier              â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ cost_amount           â”‚
                                         â”‚ sell_amount           â”‚
                                         â”‚ profit_amount         â”‚
                                         â”‚ profit_margin_percent â”‚
                                         â”‚ created_at            â”‚
                                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

CONVENCIONES:
  (PK) = Primary Key
  (FK) = Foreign Key
  UNIQUE = RestricciÃ³n Ãºnica
  N:M = RelaciÃ³n muchos a muchos
```

---

## ğŸ›ï¸ Diagrama de Clases

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ESTRUCTURAS PRINCIPALES                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      AuthController        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - register()               â”‚
â”‚ - login()                  â”‚
â”‚ - refresh()                â”‚
â”‚ - logout()                 â”‚
â”‚ - changePassword()         â”‚
â”‚ - validateToken()          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â”œâ”€â”€â–¶ AuthMiddleware
             â”‚    - authenticate()
             â”‚    - authorize()
             â”‚    - validateRole()
             â”‚
             â””â”€â”€â–¶ AuthModel
                  - createUser()
                  - findByEmail()
                  - updatePassword()

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    ProductController       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - create()                 â”‚
â”‚ - getAll()                 â”‚
â”‚ - getById()                â”‚
â”‚ - update()                 â”‚
â”‚ - delete()                 â”‚
â”‚ - getCompleteStock()       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â”œâ”€â”€â–¶ ProductModel
             â”‚    - create()
             â”‚    - findById()
             â”‚    - findByCompanyId()
             â”‚    - update()
             â”‚    - delete()
             â”‚    - updateStock()
             â”‚
             â””â”€â”€â–¶ ProductAttributeController
                  - addAttribute()
                  - getAttributes()
                  - updateAttribute()
                  - deleteAttribute()

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    SaleController          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - create()                 â”‚
â”‚ - getAll()                 â”‚
â”‚ - getById()                â”‚
â”‚ - update()                 â”‚
â”‚ - delete()                 â”‚
â”‚ - getStatistics()          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â”œâ”€â”€â–¶ SaleModel
             â”‚    - create()
             â”‚    - findById()
             â”‚    - getByCompanyId()
             â”‚
             â”œâ”€â”€â–¶ WarrantyModel
             â”‚    - createWarranty()
             â”‚    - updateWarranty()
             â”‚
             â””â”€â”€â–¶ TesseractOCR
                  - extractSerialNumber()

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   InvoiceController        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - create()                 â”‚
â”‚ - getAll()                 â”‚
â”‚ - getById()                â”‚
â”‚ - addLineItem()            â”‚
â”‚ - generatePdf()            â”‚
â”‚ - finalize()               â”‚
â”‚ - getStatistics()          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â”œâ”€â”€â–¶ InvoiceModel
             â”‚    - create()
             â”‚    - generateInvoiceNumber()
             â”‚    - addLineItem()
             â”‚    - findById()
             â”‚    - finalize()
             â”‚
             â””â”€â”€â–¶ PDFGenerator
                  - generatePdf()
                  - uploadToCloudinary()

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PurchaseController        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - create()                 â”‚
â”‚ - getAll()                 â”‚
â”‚ - getById()                â”‚
â”‚ - update()                 â”‚
â”‚ - delete()                 â”‚
â”‚ - getStatistics()          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â””â”€â”€â–¶ PurchaseModel
                  - create()
                  - calculateProfit()
                  - getAnalysis()

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ReportController         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - getCostVsRevenue()       â”‚
â”‚ - generateSalesReport()    â”‚
â”‚ - generatePurchaseReport() â”‚
â”‚ - getStatistics()          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â””â”€â”€â–¶ ReportModel
                  - queryCostVsRevenue()
                  - querySalesData()
                  - queryPurchaseData()
```

---

## ğŸ”„ Diagrama de Secuencia - Flujos Principales

### Flujo 1: Registro de Usuario y CreaciÃ³n de Empresa

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Cliente â”‚    â”‚ Frontend   â”‚    â”‚ Backend   â”‚    â”‚ Base de Datosâ”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                â”‚                 â”‚                  â”‚
     â”‚â”€ Completa      â”‚                 â”‚                  â”‚
     â”‚  formulario â”€â”€â–¶â”‚                 â”‚                  â”‚
     â”‚                â”‚                 â”‚                  â”‚
     â”‚                â”‚â”€ POST /registerâ–¶â”‚                  â”‚
     â”‚                â”‚ {email,password,â”‚                  â”‚
     â”‚                â”‚  company_data}  â”‚                  â”‚
     â”‚                â”‚                 â”‚                  â”‚
     â”‚                â”‚                 â”‚â”€ Validar datos â”€â–¶â”‚
     â”‚                â”‚                 â”‚                  â”‚
     â”‚                â”‚                 â”‚â—€â”€ âœ… Valid       â”‚
     â”‚                â”‚                 â”‚                  â”‚
     â”‚                â”‚                 â”‚â”€ CREATE user â”€â”€â”€â–¶â”‚
     â”‚                â”‚                 â”‚ CREATE company   â”‚
     â”‚                â”‚                 â”‚ CREATE user_co.  â”‚
     â”‚                â”‚                 â”‚                  â”‚
     â”‚                â”‚                 â”‚â—€â”€ user_id, co_id â”‚
     â”‚                â”‚                 â”‚                  â”‚
     â”‚                â”‚                 â”‚â”€ Generate JWT â”€â”€â–¶â”‚
     â”‚                â”‚                 â”‚                  â”‚
     â”‚                â”‚â—€â”€ 201 Created   â”‚                  â”‚
     â”‚                â”‚ {access_token,  â”‚                  â”‚
     â”‚                â”‚  refresh_token} â”‚                  â”‚
     â”‚                â”‚                 â”‚                  â”‚
     â”‚â—€â”€ âœ… Registro â”‚                 â”‚                  â”‚
     â”‚  exitoso       â”‚                 â”‚                  â”‚
```

### Flujo 2: CreaciÃ³n de Venta con OCR

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Vendedorâ”‚    â”‚ Backend    â”‚    â”‚ Tesseract    â”‚    â”‚  Cloudinary  â”‚    â”‚ Base Datos  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
     â”‚                â”‚                  â”‚                   â”‚                    â”‚
     â”‚â”€ Venta + â”€â”€â”€â”€â”€â”€â–¶â”‚                  â”‚                   â”‚                    â”‚
     â”‚  Imagen         â”‚                  â”‚                   â”‚                    â”‚
     â”‚                 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ Extraer          â”‚                    â”‚
     â”‚                 â”‚   serial_image   â”‚ serie (OCR)      â”‚                    â”‚
     â”‚                 â”‚                  â”‚                   â”‚                    â”‚
     â”‚                 â”‚â—€â”€ serie_number â”€â”€â”‚                   â”‚                    â”‚
     â”‚                 â”‚                  â”‚                   â”‚                    â”‚
     â”‚                 â”‚â”€ Subir imagen â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶                    â”‚
     â”‚                 â”‚                  â”‚                   â”‚                    â”‚
     â”‚                 â”‚â—€â”€ image_url â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                    â”‚
     â”‚                 â”‚                  â”‚                   â”‚                    â”‚
     â”‚                 â”‚â”€ Guardar venta â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
     â”‚                 â”‚ {serial_number,  â”‚                   â”‚                    â”‚
     â”‚                 â”‚  serial_image_url}                   â”‚                    â”‚
     â”‚                 â”‚                  â”‚                   â”‚                    â”‚
     â”‚                 â”‚â—€â”€ sale_id â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
     â”‚                 â”‚                  â”‚                   â”‚                    â”‚
     â”‚                 â”‚â”€ Crear warranty â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
     â”‚                 â”‚                  â”‚                   â”‚                    â”‚
     â”‚                 â”‚â—€â”€ 201 Created â”€â”€â”€â”‚                   â”‚                    â”‚
     â”‚â—€â”€ âœ… Venta     â”‚                  â”‚                   â”‚                    â”‚
     â”‚  creada        â”‚                  â”‚                   â”‚                    â”‚
```

### Flujo 3: GeneraciÃ³n de Invoice desde Venta

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Usuario â”‚    â”‚ Backend      â”‚    â”‚ Base Datos  â”‚    â”‚   jsPDF      â”‚    â”‚ Cloudinary  â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
    â”‚                â”‚                   â”‚                  â”‚                    â”‚
    â”‚â”€ Crear Invoiceâ”€â–¶â”‚                   â”‚                  â”‚                    â”‚
    â”‚ {sale_id,      â”‚                   â”‚                  â”‚                    â”‚
    â”‚  company_data} â”‚                   â”‚                  â”‚                    â”‚
    â”‚                â”‚                   â”‚                  â”‚                    â”‚
    â”‚                â”‚â”€ Generar # â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                  â”‚                    â”‚
    â”‚                â”‚ INV-2025-00001     â”‚                  â”‚                    â”‚
    â”‚                â”‚                   â”‚                  â”‚                    â”‚
    â”‚                â”‚â—€â”€ invoice_number â”€â”‚                  â”‚                    â”‚
    â”‚                â”‚                   â”‚                  â”‚                    â”‚
    â”‚                â”‚â”€ Guardar invoice â”€â–¶â”‚                  â”‚                    â”‚
    â”‚                â”‚                   â”‚                  â”‚                    â”‚
    â”‚                â”‚â—€â”€ invoice_id â”€â”€â”€â”€â”€â”‚                  â”‚                    â”‚
    â”‚                â”‚                   â”‚                  â”‚                    â”‚
    â”‚â”€ Agregar â”€â”€â”€â”€â”€â”€â–¶â”‚                   â”‚                  â”‚                    â”‚
    â”‚  items extra   â”‚â”€ Guardar items â”€â”€â”€â–¶â”‚                  â”‚                    â”‚
    â”‚  (shipping)    â”‚                   â”‚                  â”‚                    â”‚
    â”‚                â”‚â—€â”€ line_items â”€â”€â”€â”€â”€â”‚                  â”‚                    â”‚
    â”‚                â”‚                   â”‚                  â”‚                    â”‚
    â”‚â”€ Generar PDFâ”€â”€â–¶â”‚                   â”‚                  â”‚                    â”‚
    â”‚                â”‚â”€ Compilar datos â”€â–¶â”‚ Generar PDF     â”‚                    â”‚
    â”‚                â”‚                   â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶                    â”‚
    â”‚                â”‚                   â”‚                  â”‚                    â”‚
    â”‚                â”‚                   â”‚                  â”‚â”€ Subir PDF â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
    â”‚                â”‚                   â”‚                  â”‚                    â”‚
    â”‚                â”‚â—€â”€ pdf_url â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
    â”‚                â”‚                   â”‚                  â”‚                    â”‚
    â”‚â—€â”€ 201 Created â”€â”‚                   â”‚                  â”‚                    â”‚
    â”‚  {invoice_id,  â”‚                   â”‚                  â”‚                    â”‚
    â”‚   pdf_url}     â”‚                   â”‚                  â”‚                    â”‚
```

---

## ğŸ‘¥ Diagrama de Casos de Uso

```
                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚    Stakeholders          â”‚
                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚                     â”‚                     â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  ADMIN/OWNER   â”‚   â”‚   SELLER       â”‚   â”‚  INVENTORY MGR  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚                     â”‚                     â”‚
                 â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
                 â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚     STOCKLY SYSTEM v1.3.0           â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚            â”‚            â”‚              â”‚                â”‚
â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”
â”‚GestiÃ³n â”‚  â”‚GestiÃ³n â”‚  â”‚GestiÃ³n  â”‚  â”‚GestiÃ³n â”‚  â”‚  Generar   â”‚
â”‚de      â”‚  â”‚de      â”‚  â”‚de       â”‚  â”‚de      â”‚  â”‚  Invoice   â”‚
â”‚Usuariosâ”‚  â”‚Productosâ”‚  â”‚Compras  â”‚  â”‚Ventas  â”‚  â”‚  PDF       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚           â”‚            â”‚           â”‚             â”‚
    â”‚           â”‚            â”‚           â”‚             â”‚
â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”
â”‚Registerâ”‚  â”‚CRUD    â”‚  â”‚Registrarâ”‚  â”‚ CRUD   â”‚  â”‚Almacenar   â”‚
â”‚        â”‚  â”‚CategorÃ­asâ”‚ â”‚Compra   â”‚  â”‚Venta   â”‚  â”‚en Cloud    â”‚
â”‚Login   â”‚  â”‚Crear   â”‚  â”‚Calcular â”‚  â”‚OCR     â”‚  â”‚            â”‚
â”‚        â”‚  â”‚Atributosâ”‚ â”‚Profit   â”‚  â”‚Serial  â”‚  â”‚Descargar   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚           â”‚            â”‚           â”‚             â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Base Datos    â”‚
        â”‚   PostgreSQL   â”‚
        â”‚  (Supabase)    â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”Œ Diagrama de Componentes

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        STOCKLY ARCHITECTURE                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       FRONTEND (React/TypeScript)                â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚  Dashboard â”‚ â”‚ Inventario â”‚ â”‚   Ventas   â”‚ â”‚   Reportes   â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚ HTTP/REST API
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    BACKEND (Express.js)                          â”‚
â”‚                                                                  â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚                    REQUEST PIPELINE                         â”‚ â”‚
â”‚ â”‚  Request â”€â–¶ Logger â”€â–¶ Auth â”€â–¶ Validation â”€â–¶ Controller    â”‚ â”‚
â”‚ â”‚                                                   â–¼         â”‚ â”‚
â”‚ â”‚                                             Business Logic  â”‚ â”‚
â”‚ â”‚                                                   â–¼         â”‚ â”‚
â”‚ â”‚  Response â—€â”€ Error Handler â—€â”€ Model/Services â—€â”€â–¬         â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                  â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ Auth        â”‚ â”‚ Product  â”‚ â”‚ Sale       â”‚ â”‚ Invoice      â”‚   â”‚
â”‚ â”‚ Controller  â”‚ â”‚ Controllerâ”‚ â”‚Controller  â”‚ â”‚ Controller   â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ Purchase    â”‚ â”‚ Category â”‚ â”‚ Company    â”‚ â”‚ Report       â”‚   â”‚
â”‚ â”‚ Controller  â”‚ â”‚ Controllerâ”‚ â”‚Controller  â”‚ â”‚ Controller   â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚              â”‚              â”‚              â”‚
       â”‚              â”‚              â”‚              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
â”‚Tesseractâ”‚    â”‚ jsPDF   â”‚    â”‚Winston  â”‚    â”‚ Zod     â”‚
â”‚  (OCR)  â”‚    â”‚ (PDF)   â”‚    â”‚(Logging)â”‚    â”‚(Validation)
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
       â”‚              â”‚             â”‚             â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚             â”‚
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚              â”‚             â”‚                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”
â”‚ Cloudinary  â”‚ â”‚PostgreSQLâ”‚ â”‚ Environmentâ”‚ â”‚  Helmet    â”‚
â”‚(File Store) â”‚ â”‚(Database)â”‚ â”‚ (Config)   â”‚ â”‚ (Security) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”— Relaciones entre Entidades

### RelaciÃ³n 1: Usuario â†” Empresa (N:M)

```
Un usuario puede pertenecer a mÃºltiples empresas
Una empresa puede tener mÃºltiples usuarios

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   USER     â”‚ â”€â”€â”€â”€â–¶â”‚  USER_COMPANY    â”‚ â—€â”€â”€â”€â”€ â”‚ COMPANY    â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚   1:Mâ”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ M:1   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ id (PK)    â”‚      â”‚ user_id (FK)     â”‚       â”‚ id (PK)    â”‚
â”‚ email      â”‚      â”‚ company_id (FK)  â”‚       â”‚ name       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚ role             â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚ created_at       â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ROLES DISPONIBLES:
- owner: Propietario de empresa (mÃ¡ximo 1 por empresa)
- admin: Administrador con todos los permisos
- seller: Solo puede crear ventas
- inventory: Solo puede ver/actualizar inventario
```

### RelaciÃ³n 2: Producto â†” Atributo (1:N)

```
Un producto puede tener mÃºltiples atributos
Un atributo pertenece a un Ãºnico producto

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PRODUCT   â”‚ â”€â”€â”€â”€â”€â”€â–¶â”‚ PRODUCT_ATTRIBUTE    â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ 1:N    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ id (PK)    â”‚        â”‚ id (PK)              â”‚
â”‚ name       â”‚        â”‚ product_id (FK)      â”‚
â”‚ sku        â”‚        â”‚ attribute_name       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚ attribute_value      â”‚
                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

EJEMPLO:
Producto: Samsung 65" Smart TV
  â”œâ”€ ResoluciÃ³n: 4K
  â”œâ”€ Panel: QLED
  â”œâ”€ Frecuencia: 120Hz
  â””â”€ Puertos: HDMI x3, USB x2
```

### RelaciÃ³n 3: Venta â†” Invoice (1:1 o 1:N)

```
Una venta puede generar mÃºltiples invoices
Un invoice pertenece a una Ãºnica venta

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SALE    â”‚ â”€â”€â”€â”€â”€â”€â–¶â”‚  INVOICE     â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ 1:N    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ id (PK)  â”‚        â”‚ id (PK)      â”‚
â”‚ customer â”‚        â”‚ sale_id (FK) â”‚
â”‚ total    â”‚        â”‚ invoice_#    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚ total_amount â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

CASO DE USO:
- Una venta puede generar invoice inicial
- Se pueden agregar lÃ­neas adicionales (envÃ­o, impuestos, descuentos)
- Un invoice se puede separar en mÃºltiples (si es muy grande)
```

### RelaciÃ³n 4: Invoice â†” LineItem (1:N)

```
Un invoice tiene mÃºltiples lÃ­neas de items
Un item pertenece a un Ãºnico invoice

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  INVOICE     â”‚ â”€â”€â”€â”€â”€â”€â–¶â”‚ INVOICE_LINE_ITEM   â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ 1:N    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ id (PK)      â”‚        â”‚ id (PK)             â”‚
â”‚ invoice_#    â”‚        â”‚ invoice_id (FK)     â”‚
â”‚ subtotal     â”‚        â”‚ item_type           â”‚
â”‚ tax_amount   â”‚        â”‚ unit_price          â”‚
â”‚ total_amount â”‚        â”‚ quantity            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚ line_total          â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

TIPOS DE ITEMS:
- product: Producto del catÃ¡logo
- shipping: Costo de envÃ­o
- commission: ComisiÃ³n de venta
- discount: Descuento aplicado
- other: Otros cargos
```

---

## ğŸ” Flujos de AutenticaciÃ³n

### Flujo JWT - Access & Refresh Tokens

```
REGISTRO
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. Cliente envÃ­a credenciales      â”‚
â”‚    {email, password, company_data} â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. Backend valida y hashea pwd     â”‚
â”‚    Crea usuario en BD              â”‚
â”‚    Genera tokens JWT               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. Retorna tokens al cliente       â”‚
â”‚    â”œâ”€ access_token (15 min)        â”‚
â”‚    â””â”€ refresh_token (7 dÃ­as)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


LOGIN
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. Cliente envÃ­a credenciales      â”‚
â”‚    {email, password}               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. Backend valida credenciales     â”‚
â”‚    Compara password con bcrypt     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. Retorna tokens JWT              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


REFRESH TOKEN
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. Access token expirado           â”‚
â”‚    Cliente envÃ­a refresh_token     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. Backend valida refresh_token    â”‚
â”‚    Genera nuevo access_token       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. Retorna nuevo access_token      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

JWT PAYLOAD
{
  "user_id": "uuid",
  "email": "user@example.com",
  "company_id": "uuid",
  "role": "admin",
  "exp": 1729631234,
  "iat": 1729630934
}
```

---

## ğŸ“Š Estado de Transacciones

### Estados de Venta

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DRAFT   â”‚ (Inicial - Borrador)
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ COMPLETED    â”‚ (Venta finalizada)
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ INVOICED     â”‚ (Se generÃ³ invoice)
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DELIVERED    â”‚ (Entregado al cliente)
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CANCELLED    â”‚ (Cancelada)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Estados de Invoice

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”
â”‚ DRAFT â”‚ (Editable - sin finalizar)
â””â”€â”€â”€â”¬â”€â”€â”€â”˜
    â”‚ finalize()
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PENDING  â”‚ (Finalizado, sin pagar)
â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
    â”‚ markAsPaid()
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PAID    â”‚ (Pagado)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â”‚ (desde DRAFT o PENDING)
    â”‚ cancel()
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚CANCELLED â”‚ (Anulado)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Estados de GarantÃ­a

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ACTIVE  â”‚ (Vigente)
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚ (si se solicita reparaciÃ³n)
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ IN_SERVICE    â”‚ (En servicio tÃ©cnico)
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ (cuando finaliza servicio)
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ COMPLETED    â”‚ (ReparaciÃ³n completada)
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ EXPIRED      â”‚ (ExpirÃ³ la garantÃ­a)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Estados de Servicio TÃ©cnico

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ RECEIVED â”‚ (Equipo recibido)
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ IN_REPAIR    â”‚ (En reparaciÃ³n)
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DELIVERED â”‚ (Entregado reparado)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ MÃ©tricas y Ratios

### CÃ¡lculos de Profit en Compras

```
Dado:
  - cost_per_unit = $50
  - sell_price_per_unit = $80
  - quantity = 100

FÃ³rmulas:
  cost_amount = cost_per_unit Ã— quantity
              = 50 Ã— 100 = $5,000

  sell_amount = sell_price_per_unit Ã— quantity
              = 80 Ã— 100 = $8,000

  profit_amount = sell_amount - cost_amount
                = 8,000 - 5,000 = $3,000

  profit_margin_percent = (profit_amount / sell_amount) Ã— 100
                        = (3,000 / 8,000) Ã— 100
                        = 37.5%
```

### CÃ¡lculos de Impuestos en Invoice

```
Dado:
  - items_subtotal = $1,000
  - tax_percentage = 12% (IVA por defecto)
  - discount_amount = $50
  - additional_items_total = $100 (shipping)

FÃ³rmula:
  tax_amount = items_subtotal Ã— (tax_percentage / 100)
             = 1,000 Ã— 0.12 = $120

  total_amount = subtotal + tax_amount + additional_items - discount
               = 1,000 + 120 + 100 - 50
               = $1,170
```

---

## ğŸ”„ Ciclo de Vida de Entidades

### Ciclo de Producto

```
CREATE              UPDATE              DELETE
   â”‚                  â”‚                   â”‚
   â–¼                  â–¼                   â–¼
CREATED â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€UPDATEDâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º SOFT_DELETE
   â”‚                  â”‚                   â”‚
   â”‚ (activo)         â”‚ (editable)        â”‚ (no visible)
   â”‚                  â”‚                   â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        (mÃºltiples veces)

IMPORTANTE:
- Los productos usan soft delete (is_active = false)
- Nunca se eliminan fÃ­sicamente para mantener historial
- Los soft deleted no aparecen en listados
```

### Ciclo de Invoice

```
CREATE         ADD_ITEMS       GENERATE_PDF      FINALIZE
  â”‚              â”‚                 â”‚                â”‚
  â–¼              â–¼                 â–¼                â–¼
DRAFT â—€â”€â”€â”€â”€â”€â”€DRAFTâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€DRAFTâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º PENDING
  â”‚              â”‚                 â”‚                â”‚
  â”‚              â”‚                 â”‚                â”‚
  â”‚              â”‚                 â”‚ (pdf_url set)  â”‚
  â”‚              â”‚                 â”‚                â”‚
  â”‚              â”‚                 â”‚ markAsPaid()   â”‚
  â”‚              â”‚                 â”‚                â–¼
  â”‚              â”‚                 â”‚             PAID
  â”‚              â”‚                 â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€cancel()â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
                CANCELLED
```

---

## ğŸ“ˆ Roadmap de Versiones (Implementado)

### v1.0.0 - Core System
- âœ… AutenticaciÃ³n y autorizacion
- âœ… GestiÃ³n de usuarios y empresas
- âœ… CRUD bÃ¡sico de productos
- âœ… Sistema de invitaciones

### v1.1.0 - Product Management
- âœ… CategorÃ­as jerÃ¡rquicas
- âœ… Atributos dinÃ¡micos
- âœ… Estados de producto (new, used, open_box)

### v1.2.0 - Sales & Analytics
- âœ… GestiÃ³n de compras con profit tracking
- âœ… Ventas con OCR
- âœ… Reportes de costo vs ingreso
- âœ… Stock consolidado

### v1.3.0 - Invoicing System (ACTUAL)
- âœ… GeneraciÃ³n de invoices/recibos
- âœ… NumeraciÃ³n automÃ¡tica secuencial
- âœ… Items adicionales flexibles
- âœ… GeneraciÃ³n de PDF profesional
- âœ… Almacenamiento en Cloudinary

---

## ğŸ¯ ConclusiÃ³n

Este anÃ¡lisis UML proporciona una visiÃ³n completa de la arquitectura Stockly v1.3.0 para:

- **Desarrolladores**: Entender estructura de cÃ³digo y relaciones
- **Arquitectos**: DiseÃ±ar nuevas caracterÃ­sticas
- **DevOps**: Planificar despliegues y migraciones
- **Testers**: Validar flujos y casos de uso
- **Product**: Documentar funcionalidades implementadas

Para mÃ¡s detalles tÃ©cnicos, consulta:
- **API_REFERENCE.md** - Endpoints y ejemplos
- **ARCHITECTURE.md** - Stack tecnolÃ³gico
- **DEPLOYMENT_GUIDE.md** - Despliegue a producciÃ³n

